**[[home:|Start]]** -> **[[home:php:|PHP]]** -> **[[home:php:basics:|PHP Basics]]** -> **Debugging PHP**

====== Debugging PHP ======

  * [[home:php:basics:debug:x:|xDebug]] 
  * phpdbg
  * Zend Debugger (Zend Studio)

[[https://tideways.com/the-6-best-php-profilers|The 6 Best PHP Profilers]], [[https://php.libhunt.com/xdebug-alternatives|xDebug alternatives]] or [[https://www.browserstack.com/guide/php-debug-tool|Best PHP Debugging Tools]]
====== Debugging HTTP ======

===== Endpoints to use for testing HTTP Requests =====

[[http://httpbin.org/|httpbin]] - A simple HTTP Request & Response Service
<code bash>
$ docker run -p 80:80 kennethreitz/httpbin
</code>

<code php>
<?php

// GET request
$curl = curl_init("http://httpbin.org/get?a=42");
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
$response = curl_exec($curl);
cul_close($curl);
echo $response;

// User-Agent Header
$curl = curl_init("http://httpbin.org/user-agent");
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curlsetopt($curl, CURLOPTHTTPHEADER, array("User-Agent: php-curl"));
$response = curl_exec($curl);
curl_close($curl);
echo $response;
</code>
**httpbin.php**

<code bash>
$ php -f httpbin.php
</code>

**[[http://requestb.in/|Request bin]]** click on create request and use it as $url
<code php>
<?php

require "../vendor/autoloader.php";

$url = "http://requestb.in/example";
$client = new \GuzzleHttp\Client(); // $client->get($url);

$request = $client->createRequest('POST', $url . "?page=42");
$request->setHeader("Authorizeation", "token a38");
$request->setheader("User-Agent", "GuzzlePHP");
$requestBody = $request->getBody
$requestBody->setField("name", "Camilla");
$requestBody->setField("species", "Camel");
$response = $client->send($request);
</code>
**requestbin.php**

<code bash>
$ php -f requestbin.php
</code>
Now refresh browser window

**[[http://respondto.it/|Respond to it]]** 
<code php>
<?php

require "../vendor/autoloader.php";

$url = "http://respondto.it/my-endpoint";
$client = new \GuzzleHttp\Client(); // $client->get($url);

$request = $client->createRequest('POST', $url . "?page=42");
$request->setHeader("Authorizeation", "token a38");
$request->setheader("User-Agent", "GuzzlePHP");
$requestBody = $request->getBody
$requestBody->setField("name", "Camilla");
$requestBody->setField("species", "Camel");
$response = $client->send($request);
</code>
**respondtoip.php**

<code bash>
$ php -f respondtoip.php
</code>
try [[http://respondto.it/my-endpoint?view|View my Request]] at [[http://respondto.it/|respondto.it]]
===== cURL from the CLI =====

[[http://curl.haxx.se|cURL Homepage]] in der Network Section der Developer tools von Google Chrome biete der rechts click **copy as curl** an. In der Zwischenablage leigt dann der curl Befehl der in der Konsole ausgef√ºhrt werden kann um z.B. eine Datei herunter zu laden. Der curl Request entspricht dann genau dem von Google Chrome.

**cURL Hints for GET:**
  * **-s** silent mode, supressing unnecessary progress bar
  * python -mjson.tool displays json output nicely 

<code bash>
$ curl -s http://localhost:8888/events | python -mjson.tool
</code>

**cURL POST:** Create a resource
  * **-X POST**, this works also with GET, PUT, DELETE  
  * -d name="Excellent Technical Event"

<code bash>
$ curl -X POST http://localhost:8888/events -d name="Excellent Technical Event"
$ curl -s http://localhost:8888/events | python -mjson.tool
$ curl -X DELETE http://localhost:8888/events/4 
</code>

**cURL switches**
  * -v show request and response header
===== Wireshark: Network Protocol Analyser =====

[[https://www.wireshark.org/|Wireshark]] is across platform network analyser. It is running outside your application so nothing has to be changed in the code. Select your network card and filter on http to skip low level IP packages.

In package view is a right click menu entry **Follow TCP Stream** can be helpful to pare up requests and responses

Install tcpdump on a remote server and capture all traffic, download the captured traffic an visualise it with wireshark locally.

**Get to know this tool, so you can use it if you are under pleasure**
===== Charles: Web Debugging Proxy =====

[[https://www.charlesproxy.com/download/latest-release/|Charles]] is a cheap alternative to [[https://www.telerik.com/download/fiddler|Fiddler]]. You can enable a Firefox Extension to proxy all Firefox request to Charles and from Charles to wherever it should go originally. You can rewrite the requests (Tools/Rewrite Menu)  within Charles, like rewriting image path while developing on a copy of a web side.

Charles has two  tabs at the top, **Structure** for URL stemming to pic a request and __**Sequence**__ as a chronological history in the upper part of the Sequence page. The bottom part of the Sequence page has the details, here you can see the Headers, HTML as HTML or Text, JSON as drill instructor or as Text. 

Under the Tools menu you can enable Throttling to limit connection speed e.g. 3G or Dialog Modem, to check your app for mobile consumers.

By default Charles runs on port 8888, so you can configure the mobile to proxy through your laptop to see what your mobile is sending. 

==== Debugging SSL ====

Within SSL Charles is smarter than Wireshark, Charles is working as a man-in-the-middle attack. You request Charles and Charles requests the remote site. Charles decodes the SSL and sees everything in plane text.
